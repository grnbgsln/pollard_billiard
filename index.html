<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sistem Libur & Shift Rolling</title>
  <style>
    body {
      font-family: "Poppins", "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #eef2ff 0%, #fefefe 100%);
      color: #1e293b;
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      margin: 20px 0 10px;
      color: #1e40af;
      font-size: 1.8rem;
    }

    p.subtitle {
      text-align: center;
      color: #475569;
      margin-bottom: 20px;
      font-size: 1rem;
    }

    .highlight {
      color: #2563eb;
      font-weight: 600;
    }

    .nav-link {
      display: inline-block;
      padding: 10px 20px;
      background: #2563eb;
      color: #fff;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.2s;
      margin-bottom: 20px;
    }

    .nav-link:hover {
      background: #1e40af;
      transform: translateY(-2px);
    }

    .controls {
      text-align: center;
      margin-bottom: 30px;
    }

    input[type="date"] {
      padding: 8px 12px;
      border: 1px solid #cbd5e1;
      border-radius: 8px;
      font-size: 1rem;
      color: #1e293b;
      background-color: #fff;
      transition: border-color 0.2s;
    }

    input[type="date"]:focus {
      border-color: #2563eb;
      outline: none;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 0 20px;
    }

    .shift {
      background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
      border-radius: 18px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
      padding: 24px;
      width: 260px;
      transition: all 0.25s ease;
      position: relative;
      overflow: hidden;
    }

    .shift::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      height: 5px;
      width: 100%;
      background: linear-gradient(90deg, #3b82f6, #60a5fa);
      border-top-left-radius: 18px;
      border-top-right-radius: 18px;
    }

    .shift:nth-child(2)::before {
      background: linear-gradient(90deg, #16a34a, #4ade80);
    }

    .shift:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 22px rgba(0, 0, 0, 0.12);
    }

    .shift h3 {
      color: #1e3a8a;
      margin-top: 8px;
      margin-bottom: 15px;
      font-size: 1.2rem;
      text-align: center;
      letter-spacing: 0.5px;
    }

    .shift ol {
      margin: 0;
      padding-left: 22px;
      font-size: 0.95rem;
      color: #334155;
    }

    .shift ol li {
      padding: 3px 0;
      transition: color 0.2s;
    }

    .shift ol li:hover {
      color: #2563eb;
    }

    h2 {
      text-align: center;
      margin-top: 50px;
      color: #1e40af;
    }

    .days {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 16px;
      width: 100%;
      max-width: 950px;
      margin: 0 auto 60px;
      padding: 0 20px;
    }

    .day {
      border-radius: 12px;
      padding: 15px;
      color: #1e293b;
      text-align: center;
      font-weight: 500;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
      transition: all 0.25s;
    }

    .day:hover {
      transform: scale(1.03);
    }

    .Senin { background: #ffe2e2; }
    .Selasa { background: #d9f7d9; }
    .Rabu { background: #e3e8ff; }
    .Kamis { background: #fff7cc; }
    .Jumat { background: #f0e6ff; }
    .Sabtu { background: #ece7e1; }
    .Minggu { background: #e2f0ff; }
  </style>
</head>
<body>
  <!-- Tombol Form Izin -->
  <div style="text-align:center;">
    <a href="izin.html" class="nav-link">üìù Form Izin / Libur</a>
  </div>

  <h1>üìÖ Sistem Libur & Shift Rolling</h1>
  <p class="subtitle">
    Pilih tanggal untuk simulasi shift & libur (otomatis berubah saat tanggal diganti)<br />
    <span id="date-info" class="highlight"></span>
  </p>

  <div class="controls">
    <input type="date" id="datePicker" />
  </div>

  <div class="container" id="shift-container"></div>

  <h2>üìÜ Jadwal Libur Minggu Ini</h2>
  <div class="days" id="days"></div>

  <script>
    const shift1 = ["Ozat", "Jaya", "Susma", "Nada", "Lilik", "Fitri", "Mila"];
    const shift2 = ["Bram", "Riyan", "Faisal", "Nanda", "Upik", "Afifa", "Fadli"];
    const allEmployees = [...shift1, ...shift2];

    const baseSchedule = {
      "Senin": ["Ozat", "Afifa"],
      "Selasa": ["Nada", "Bram"],
      "Rabu": ["Jaya", "Upik"],
      "Kamis": ["Susma", "Faisal"],
      "Jumat": ["Lilik", "Fadli"],
      "Sabtu": ["Mila", "Riyan"],
      "Minggu": ["Fitri", "Nanda"],
    };

    const baseDays = ["Senin","Selasa","Rabu","Kamis","Jumat","Sabtu","Minggu"];
    const daysOrder = ["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"];
    const months = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
    const MS_PER_DAY = 24 * 60 * 60 * 1000;

    function firstMondayOfYear(year) {
      const d = new Date(year,0,1);
      const day = d.getDay();
      const offset = (8 - day) % 7;
      d.setDate(d.getDate() + offset);
      d.setHours(0,0,0,0);
      return d;
    }

    function weeksSinceStart(refDate, date) {
      const diff = Math.floor((date - refDate)/MS_PER_DAY);
      return Math.floor(diff/7);
    }

    function daysSinceStart(refDate, date) {
      return Math.floor((date - refDate)/MS_PER_DAY);
    }

    function dateFromInput(value) {
      if(!value) return new Date();
      return new Date(value+'T00:00:00');
    }

    function render(date){
      const today = new Date(date.getFullYear(),date.getMonth(),date.getDate());
      const startRef = firstMondayOfYear(today.getFullYear());
      if(today < startRef){
        const prevStart = firstMondayOfYear(today.getFullYear()-1);
        if(today >= prevStart) startRef.setTime(prevStart.getTime());
      }

      const dayCount = daysSinceStart(startRef,today);
      const weekCount = weeksSinceStart(startRef,today);
      const isSwapped = Math.floor(dayCount/3) % 2 === 1;
      const currentShift1 = isSwapped ? shift2 : shift1;
      const currentShift2 = isSwapped ? shift1 : shift2;
      const shiftBy = ((weekCount % 7)+7)%7;

      const rotated = {};
      baseDays.forEach((day, idx)=>{
        const newIndex = (idx+shiftBy)%7;
        const targetDay = baseDays[newIndex];
        rotated[targetDay] = baseSchedule[day] ? [...baseSchedule[day]] : [];
      });

      const displayWeekNumber = weekCount + 1;
      const formattedDate = `${today.getDate()} ${months[today.getMonth()]} ${today.getFullYear()}`;
      document.getElementById("date-info").innerText =
        `Minggu ke-${displayWeekNumber} (patokan Senin pertama tahun), tanggal ${formattedDate}`;

      const shiftContainer = document.getElementById("shift-container");
      const daysDiv = document.getElementById("days");
      shiftContainer.innerHTML = "";
      daysDiv.innerHTML = "";

      const todayName = daysOrder[today.getDay()];

      if(todayName === "Jumat"){
        const fridayOff = rotated["Jumat"] || [];
        const workingPeople = allEmployees.filter(p=>!fridayOff.includes(p));
        const div = document.createElement("div");
        div.className = "shift";
        div.innerHTML = `<h3>SHIFT KHUSUS JUMAT</h3><ol>${workingPeople.map(m=>`<li>${m}</li>`).join("")}</ol>`;
        shiftContainer.appendChild(div);
      } else {
        const shifts = [
          {name:"SHIFT 1 - PAGI", members: currentShift1},
          {name:"SHIFT 2 - MALAM", members: currentShift2}
        ];
        shifts.forEach(s=>{
          const div = document.createElement("div");
          div.className = "shift";
          div.innerHTML = `<h3>${s.name}</h3><ol>${s.members.map(m=>`<li>${m}</li>`).join("")}</ol>`;
          shiftContainer.appendChild(div);
        });
      }

      baseDays.forEach(day=>{
        const list = rotated[day] || [];
        const div = document.createElement("div");
        div.className = `day ${day}`;
        div.innerHTML = `<h4>${day}</h4><p>${list.join("<br>")}</p>`;
        daysDiv.appendChild(div);
      });
    }

    const datePicker = document.getElementById("datePicker");
    const initDate = new Date();
    datePicker.valueAsDate = initDate;
    render(new Date(initDate.getFullYear(),initDate.getMonth(),initDate.getDate()));
    datePicker.addEventListener("input", e=>{
      const chosen = dateFromInput(e.target.value);
      render(chosen);
    });
  </script>
</body>
</html>
